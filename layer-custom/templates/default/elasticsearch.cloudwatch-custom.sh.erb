#!/bin/sh
instance = search("aws_opsworks_instance", "self:true").first
aws cloudwatch put-metric-data --region <%= instance['region'] %> --namespace "ElasticSearch-<%= node.elasticsearch[:cluster][:name] %>" --metric-name "number_of_data_nodes" --unit "Count" --value "`curl -s 'http://localhost:9200/_cluster/health' | python -c 'import json,sys;obj=json.load(sys.stdin);print obj["number_of_data_nodes"]'`"
